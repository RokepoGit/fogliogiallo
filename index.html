<!-- 
 ######################################################### 
 MODULO INTERVENTO ON LINE
 Rokepo srl - V2.05 - 11-2024
 Versione Git: https://github.com/RokepoGit/fogliogiallo.git
 #########################################################
-->

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8"> <!-- Imposta la codifica dei caratteri a UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Rende il layout responsivo -->
    <title>Modulo Intervento</title> <!-- Titolo della pagina -->
    <style>
        /* Stili generali per il corpo della pagina */
            
        body {
            background-color: #FFFACD; /* Colore di sfondo giallo pastello */
            font-family: Arial, sans-serif; /* Font utilizzato per il testo */
            margin: 0; /* Rimuove il margine predefinito */
            padding: 2rem; /* Padding interno per il corpo */
        }
        /* Stili per l'intestazione */
        .header {
            text-align: center; /* Allinea il contenuto al centro */
            margin-bottom: 0px; /* Margine inferiore per l'intestazione */
        }
        /* Stili per il logo */
        .logo {
            width: 100%; /* Logo a tutta larghezza */
            height: auto; /* Mantiene le proporzioni del logo */
            max-width: 850px; /* Rimuove la larghezza massima per il logo */
        }
        /* Stili per il contenuto principale */
        .content {
            border: 1px solid #000; /* Bordo nero attorno al contenuto */
            padding: 2rem; /* Padding interno per il contenuto */
            background-color: white; /* Colore di sfondo bianco per il contenuto */
            width: 90%; /* Larghezza del contenuto */
            max-width: 800px; /* Larghezza massima per il contenuto */
            margin: auto; /* Centra il contenuto nella pagina */
        }
        /* Stili per le caselle informative */
        .info-box {
            border: 1px solid #000; /* Bordo per la cornice */
            padding: 1px; /* Spazio interno */
            margin-bottom: 20px; /* Spazio sotto la cornice */
        }
        /* Stili per la tabella di lavoro */
        .work-table {
            border: 1px solid #000; /* Bordo per la cornice della tabella */
            width: 100%; /* Larghezza della tabella */
            border-collapse: collapse; /* Unisce i bordi delle celle */
            margin-top: 20px; /* Spazio sopra la tabella */
        }
        /* Stili per le celle della tabella */
        .work-table th, .work-table td {
            border: 1px solid #000; /* Bordo per celle */
            padding: 8px; /* Spazio interno nelle celle */
            text-align: left; /* Allinea il testo a sinistra */
        }
        /* Stili per l'intestazione della tabella */
        .work-table th {
            background-color: #f2f2f2; /* Colore di sfondo per l'intestazione */
        }
        /* Stili per il gruppo di checkbox */
        .checkbox-group {
            border: 1px solid #000; /* Bordo per la cornice dei checkbox */
            padding: 10px; /* Spazio interno */
            margin-top: 20px; /* Spazio sopra la cornice */
        }
        /* Stili per il titolo del gruppo di checkbox */
        .checkbox-title {
            font-weight: bold; /* Grassetto per il titolo */
            margin-bottom: 10px; /* Spazio sotto il titolo */
        }
        /* Stili per le etichette dei checkbox */
        .checkbox-label {
            display: flex; /* Layout flessibile per allineare checkbox e input */
            align-items: center; /* Allinea verticalmente al centro */
            margin-bottom: 5px; /* Spazio sotto ogni checkbox */
        }
        /* Stili per la parte sinistra delle etichette dei checkbox */
        .checkbox-label-left {
            justify-content: flex-start; /* Allinea a sinistra */
            width: 50%; /* Larghezza per la parte sinistra */
        }
        /* Stili per la parte destra delle etichette dei checkbox */
        .checkbox-label-right {
            justify-content: flex-end; /* Allinea a destra */
            width: 50%; /* Larghezza per la parte destra */
            display: flex; /* Layout flessibile per allineare elementi */
            align-items: center; /* Allinea verticalmente al centro */
        }
        /* Stili per i campi di input */
        .field {
            display: flex; /* Layout flessibile per allineare etichette e input */
            align-items: center; /* Allinea verticalmente al centro */
            margin-bottom: 5px; /* Spazio sotto ogni campo */
            padding-top: 5px; /* Spazio sopra ogni campo */
            justify-content: flex-start; /* Allinea i campi a sinistra */
        }
        /* Stili per le etichette dei campi */
        .field label {
            width: 30%; /* Larghezza fissa per le etichette */
        }
        /* Stili per i campi di input */
        .field input {
            width: 65%; /* Larghezza per i campi di input */
        }
        /* Stili per il campo data */
        .field input[type="date"] {
            width: 15ch; /* Larghezza per il campo data */
        }
        /* Stili per il campo Offerta N° */
        .offer-input {
            width: 50px; /* Larghezza per il campo Offerta N° */
            margin: 0 10px; /* Spazio orizzontale tra gli elementi */
        }
        /* Stili per il campo Del */
        .del-input {
            margin-left: 10px; /* Spazio a sinistra per il campo Del */
        }
        /* Stili per le note */
        .note {
            margin-top: 20px; /* Spazio sopra la nota */
            font-style: italic; /* Stile corsivo per la nota */
            color: #555; /* Colore grigio per la nota */
        }
        /* Stili per la linea di separazione */
        .separator {
            border-top: 1px solid #ccc; /* Linea di separazione */
            margin: 5px 0; /* Spazio sopra e sotto la linea */
        }
        /* Aggiunto per impostare il colore di sfondo dei canvas */
       
        .canvas-container {
            /*display: flex;
            flex-wrap: wrap;
            gap: 20px;*/
            width: 50px; /* Larghezza per il campo */
            margin: 0 10px; /* Spazio orizzontale tra gli elementi */
        }

        canvas {
            border: 1px solid #000;
            background-color: #d0cdff97; /* Colore grigio pastello */
            touch-action: none; /* Necessario per gestire il touch */
        }



        /* Media queries per schermi più piccoli */
        @media (max-width: 2000px) {
            .field label {
                width: 40%; /* Aumenta la larghezza delle etichette su schermi piccoli */
            }

            .field input {
                width: 55%; /* Riduce la larghezza dei campi di input su schermi piccoli */
            }

            body {
                padding: 1rem; /* Riduce il padding per schermi piccoli */
            }

            .content {
                padding: 1rem; /* Riduce il padding per il contenuto su schermi piccoli */
            }

            .canvas-container {
                /* flex-direction: column;
                align-items: center;*/
                width: 100%; /* Larghezza per il campo */
            margin: 0 10px; /* Spazio orizzontale tra gli elementi */
            } 

            canvas {
                width: 500px;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="rokepo-logo.jpg" alt="Logo Rokepo" class="logo"> <!-- Logo dell'azienda -->
        <!-- <h1>Modulo Intervento</h1> --> <!-- Titolo principale (commentato) -->
    </div>
    <!-- Container principale -------------------------- -->
    <div class="content">
        <!-- Box informazioni di base ------------------ -->
        <div class="info-box">
            <div id="operator-field-container"> <!-- Contenitore per i campi operatore -->
                <div class="field" id="operator-field1">
                    <label for="operatore1" style="margin-left: 10px;">Operatore 1:</label>
                    <input type="text" list="operatori" style="width: calc(100% - 200px); margin-right: 10px;" onfocus="startDictation(this)">
                    <datalist id="operatori">
                    <option value="Maurizio Rispoli">
                    <option value="Marco Cumani">
                    <option value="Isiah Lewis">
                    <option value="Gianluca Papa">
                    <option value="Paolo Bonazzi">
                    </datalist>
                    <button type="button" id="add-operator" style="margin-left: 10px;">+</button> <!-- Pulsante per aggiungere l'operatore -->
                    <button type="button" id="remove-operator" style="margin-left: 10px;">- </button> <!-- Pulsante per aggiungere l'operatore -->
                </div>
            </div>
            <div class="field">
                <label for="data-intervento:" style=" margin-left: 10px; white-space: nowrap;">Data intervento:</label> <!-- Etichetta per il campo Data intervento -->
                <input type="date" id="data-intervento" style="margin-right: 10px;"> <!-- Campo di input per la data dell'intervento -->
            </div>
        
            <div class="field">
                <label for="cliente" style="margin-left: 10px;">Cliente:</label> <!-- Etichetta per il campo Cliente -->
                <input type="text" id="cliente" style="width: calc(100% - 200px); margin-right: 10px;" onfocus="startDictation(this)"> <!-- Campo di input per il cliente con supporto per la dettatura -->
            </div>
            <div class="field">
                <label for="sede" style="margin-left: 10px;">Sede/impianto:</label> <!-- Etichetta per il campo Sede -->
                <input type="text" id="sede" style="width: calc(100% - 200px); margin-right: 10px;" onfocus="startDictation(this)"> <!-- Campo di input per la sede con supporto per la dettatura -->
            </div>
        </div>
        <!-- CheckBox tipo di intervento --------------- -->
        <div class="checkbox-group">
            <div class="checkbox-title">Motivo dell'intervento presso il cliente:</div> <!-- Titolo per il gruppo di checkbox -->
            <div class="checkbox-label">
                <div class="checkbox-label-left">
                    <label>
                        <input type="checkbox" name="reason" value="sopralluogo" id="chek_sopralluogo"> Sopralluogo <!-- Checkbox per il motivo Sopralluogo -->
                    </label>
                </div>
                <div class="checkbox-label-right">
                    <label>Offerta N°</label> <!-- Etichetta per il campo Offerta N° -->
                    <input type="text" class="offer-input" maxlength="3" onfocus="startDictation(this)"> <!-- Campo di input per Offerta N° con supporto per la dettatura -->
                    <label>Del</label> <!-- Etichetta per il campo Del -->
                    <input type="date" id="data-offerta-1" class="del-input"> <!-- Campo di input per la data Del -->
                </div>
            </div>
            <div class="separator"></div> <!-- Linea di separazione -->
            <div class="checkbox-label">
                <div class="checkbox-label-left">
                    <label>
                        <input type="checkbox" name="reason" value="installazione"> Installazione <!-- Checkbox per il motivo Installazione -->
                    </label>
                </div>
                <div class="checkbox-label-right">
                    <label>Contratto N°</label> <!-- Etichetta per il campo Contratto N° -->
                    <input type="text" class="offer-input" maxlength="3" onfocus="startDictation(this)"> <!-- Campo di input per Contratto N° con supporto per la dettatura -->
                    <label>Del</label> <!-- Etichetta per il campo Del -->
                    <input type="date" class="del-input"> <!-- Campo di input per la data Del -->
                </div>
            </div>
            <div class="separator"></div> <!-- Linea di separazione -->
            <div class="checkbox-label">
                <div class="checkbox-label-left">
                    <label>
                        <input type="checkbox" name="reason" value="assistenza"> Assistenza <!-- Checkbox per il motivo Assistenza -->
                    </label>
                </div>
                <div class="checkbox-label-right">
                    <label>Offerta N°</label> <!-- Etichetta per il campo Offerta N° -->
                    <input type="text" class="offer-input" maxlength="3" onfocus="startDictation(this)"> <!-- Campo di input per Offerta N° con supporto per la dettatura -->
                    <label>Del</label> <!-- Etichetta per il campo Del -->
                    <input type="date" class="del-input"> <!-- Campo di input per la data Del -->
                </div>
            </div>
            <div class="separator"></div> <!-- Linea di separazione -->
            <div class="checkbox-label">
                <div class="checkbox-label-left">
                    <label>
                        <input type="checkbox" name="reason" value="manutenzione"> Assistenza/Manutenzione Programmata <!-- Checkbox per il motivo Manutenzione -->
                    </label>
                </div>
                <div class="checkbox-label-right">
                    <label>Contratto N°</label> <!-- Etichetta per il campo Contratto N° -->
                    <input type="text" class="offer-input" maxlength="3" onfocus="startDictation(this)"> <!-- Campo di input per Contratto N° con supporto per la dettatura -->
                    <label>Del</label> <!-- Etichetta per il campo Del -->
                    <input type="date" class="del-input"> <!-- Campo di input per la data Del -->
                </div>
            </div>
            <div class="separator"></div> <!-- Linea di separazione -->
            <div class="checkbox-label">
                <div class="checkbox-label-left">
                    <label>
                        <input type="checkbox" name="reason" value="garanzia"> Assistenza in GARANZIA <!-- Checkbox per il motivo Garanzia -->
                    </label>
                </div>
                <div class="checkbox-label-right">
                    <label>Contratto N°</label> <!-- Etichetta per il campo Contratto N° -->
                    <input type="text" class="offer-input" maxlength="3" onfocus="startDictation(this)"> <!-- Campo di input per Contratto N° con supporto per la dettatura -->
                    <label>Del</label> <!-- Etichetta per il campo Del -->
                    <input type="date" class="del-input"> <!-- Campo di input per la data Del -->
                </div>
            </div>
        </div>
        <!-- Testo per le note ------------------------- -->
        <div class="note">
            N.B. Nel momento in cui è stato scelto il campo assistenza, il presente modulo viene utilizzato dal personale amministrativo della ROKEPO per procedere all'attività di fatturazione. <!-- Nota informativa -->
        </div>
        <!-- Tabella lavori eseguiti ------------------- -->
        <div class="work-table">
            <table>
                <thead>
                    <tr>
                        <th style="width: 50%;">Descrizione Lavori Eseguiti</th> <!-- Prima colonna massimizzata per la descrizione dei lavori -->
                        <th style="width: 10%;">Ora Inizio</th> <!-- Colonna ridotta per l'ora di inizio -->
                        <th style="width: 10%;">Ora Fine</th> <!-- Colonna ridotta per l'ora di fine -->
                        <th style="width: 10%;">Totale Ore Lavorate</th> <!-- Colonna per il totale delle ore lavorate -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <!-- Descrizione lavoro 1 -->
                        <td>
                            <textarea id="descrizione-lavoro-1" placeholder="Descrizione lavoro 1" rows="1" style="width: 100%; box-sizing: border-box;" onfocus="startDictation(this)" ></textarea>
                        </td>
                        <td><input type="time" class="start-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="time" class="end-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="text" placeholder="Ore" class="total-hours" style="width: 100%;" disabled></td>
                    </tr>
                    <!-- Descrizione lavoro 2 -->
                    <tr>
                        <td><textarea id="descrizione-lavoro-2" placeholder="Descrizione lavoro 2" rows="1" style="width: 100%; box-sizing: border-box;" onfocus="startDictation(this)" ></textarea></td>
                        <td><input type="time" class="start-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="time" class="end-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="text" placeholder="Ore" class="total-hours" style="width: 100%;" disabled></td> <!-- Nuovo campo per totale ore lavorate -->
                    </tr>
                    <!-- Descrizione lavoro 3 -->
                    <tr>
                        <td><textarea id="descrizione-lavoro-3" placeholder="Descrizione lavoro 3" rows="1" style="width: 100%; box-sizing: border-box;" onfocus="startDictation(this)" ></textarea></td>
                        <td><input type="time" class="start-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="time" class="end-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="text" placeholder="Ore" class="total-hours" style="width: 100%;" disabled></td> <!-- Nuovo campo per totale ore lavorate -->
                    </tr>
                    <!-- Descrizione lavoro 4 -->
                    <tr>
                        <td><textarea id="descrizione-lavoro-4" placeholder="Descrizione lavoro 4" rows="1" style="width: 100%; box-sizing: border-box;" onfocus="startDictation(this)" ></textarea></td>
                        <td><input type="time" class="start-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="time" class="end-time" style="width: 100%;" onchange="calculateTotal(this)"></td>
                        <td><input type="text" placeholder="Ore" class="total-hours" style="width: 100%;" disabled></td> <!-- Nuovo campo per totale ore lavorate -->
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: right;"><strong>Totale Ore Lavorate:</strong></td> <!-- Totale ore lavorate -->
                        <td><input type="text" placeholder="Ore" class="total-hours" id="total-hours-sum" style="width: 100%;" disabled></td> <!-- Totale ore lavorate con larghezza fissa -->
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="text-align: right;"><strong>Numero di addetti:</strong></td> <!-- Numero di addetti -->
                        <td>
                            <input type="number" id="numero-addetti" value="1" min="1" style="width: 50px;" oninput="updateTotalHours();"> <!-- Campo per il numero di addetti -->
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: right;"><strong>Ore Totali (con addetti):</strong></td> <!-- Ore totali con addetti -->
                        <td>
                            <input type="text" id="total-hours-with-staff" style="width: 100%;" disabled> <!-- Campo per le ore totali con addetti -->
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Tabella prodotti utilizzati --------------- -->
        <div class="work-table">
            <table style="width: 100%; margin-top: 20px;">
                <thead>
                    <tr>
                        <th style="text-align: center;">
                            PRODOTTI UTILIZZATI<br>
                            <span style="font-size: x-small;">(da indicare esclusivamente nel caso in cui i prodotti non siano stati indicati nel DDT utilizzato per accompagnare i prodotti)</span> <!-- Titolo per i prodotti utilizzati -->
                        </th>
                        <th style="font-size: small; text-align: center; width: 50px;">Quantità</th> <!-- Colonna per la quantità -->
                        <th style="font-size: small; text-align: center;">Eventuale prodotto sostituito e DDT di riferimento</th> <!-- Colonna per eventuali prodotti sostituiti -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <datalist id="articoli1"></datalist> <!-- Datalist vuoto -->
                        <td><input type="text" placeholder="Prodotto 1" list="articoli1" style="width: 100%;"  onfocus="startDictation(this)"></td> <!-- Campo per il nome del prodotto 1 -->
                        <td><input type="number" placeholder="Quantità" style="width: 100%;"></td> <!-- Campo per la quantità del prodotto 1 -->
                        <td><input type="text" placeholder="Note" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per eventuali note sul prodotto 1 -->
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Prodotto 2" list="articoli1" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per il nome del prodotto 2 -->
                        <td><input type="number" placeholder="Quantità" style="width: 100%;"></td> <!-- Campo per la quantità del prodotto 2 -->
                        <td><input type="text" placeholder="Note" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per eventuali note sul prodotto 2 -->
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Prodotto 3" list="articoli1" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per il nome del prodotto 3 -->
                        <td><input type="number" placeholder="Quantità" style="width: 100%;"></td> <!-- Campo per la quantità del prodotto 3 -->
                        <td><input type="text" placeholder="Note" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per eventuali note sul prodotto 3 -->
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Prodotto 4" list="articoli1" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per il nome del prodotto 4 -->
                        <td><input type="number" placeholder="Quantità" style="width: 100%;"></td> <!-- Campo per la quantità del prodotto 4 -->
                        <td><input type="text" placeholder="Note" style="width: 100%;" onfocus="startDictation(this)"></td> <!-- Campo per eventuali note sul prodotto 4 -->
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Dati finali  ------------------------------- -->
        <div class="info-box">
            <div style="margin-top: 20px; display: flex; width: 100%; align-items: center;">
                <label style="margin-right: 10px; margin-left: 10px">Ulteriori prodotti da fatturare consegnati con il DDT N°:</label> <!-- Etichetta per ulteriori prodotti -->
                <input type="text" placeholder="Numero DDT" style="width: 100px; margin-right: 10px;"> <!-- Campo per il numero DDT -->
                <label style="margin-right: 5px;">del</label> <!-- Etichetta per la data Del -->
                <input type="date" style="margin-left: 10px;"> <!-- Campo per la data Del -->
            </div>
            <div style="margin-top: 20px; display: flex; align-items: center;"> <!-- Nuova riga per chilometri e ore di viaggio -->
                <label style="margin-right: 10px;margin-left: 10px">Chilometri percorsi per raggiungere il cliente e ritornare Km:</label> <!-- Etichetta per i chilometri -->
                <input type="number" placeholder="Km" style="width: 100px; margin-right: 10px;"> <!-- Campo per i chilometri -->
                <label style="font-size: small; margin-right: 5px;">Ore viaggio:</label> <!-- Etichetta per le ore di viaggio -->
                <input type="text" placeholder="Ore-Viaggio" style="width: 100px; margin-left: 10px;"> <!-- Campo per le ore di viaggio -->
            </div>
            <div style="margin-top: 20px; display: flex; align-items: center;"> <!-- Nuova riga per Stato intervento -->
                <label style="margin-right: 10px;margin-left: 10px ">Stato intervento: CONCLUSO</label> <!-- Etichetta per lo stato dell'intervento -->
                <select style="margin-right: 10px;"> <!-- Selettore per lo stato dell'intervento -->
                    <option value="si">Sì</option> <!-- Opzione Sì -->
                    <option value="no">No</option> <!-- Opzione No -->
                    </select>
                <label style="margin-right: 5px;">Note:</label> <!-- Etichetta per eventuali note -->
                <input type="text" placeholder="Eventuali note" style="width: 200px; margin-bottom: 10px"> <!-- Campo per eventuali note di testo -->
            </div>
        </div>
        <div style="display: flex; margin-top: 20px; align-items: stretch; width: 100%;"> <!-- Cambiato a 'stretch' per garantire che occupino la stessa altezza -->
            <div class="canvas-container" style="width: 100%; display: flex; flex-direction: column; align-items: center; margin-right: 20px;"> <!-- Contenitore per la firma operatore -->
                <label>Firma Operatore Rokepo</label> <!-- Etichetta per la firma dell'operatore -->
                <canvas id="canvas1" style="margin-left: 20px; width: 100%; display: flex; flex-direction: column; align-items: center; margin-right: 20px;"></canvas> <!-- Box per la firma operatore -->
                <button id="clear-signature-operator" style="margin-top: 10px;">Pulisci Firma Operatore</button> <!-- Pulsante per pulire la firma operatore -->
            </div>
            <div class="canvas-container"style="width: 100%; display: flex; flex-direction: column; align-items: center; "> <!-- Contenitore per la firma cliente -->
                <label>Firma Cliente</label> <!-- Etichetta per la firma del cliente -->
                <canvas id="canvas2" style="margin-left: 20px; width: 100%; display: flex; flex-direction: column; align-items: center; margin-right: 20px;""></canvas> <!-- Box per la firma cliente -->
                <button id="clear-signature-client" style="margin-top: 10px;">Pulisci Firma Cliente</button> <!-- Pulsante per pulire la firma cliente -->
            </div>
         </div>  <!-- width: 250px; height: 150px; -->
    </div>
    <button id="generate-pdf" style="margin-top: 20px;">Genera PDF</button> <!-- Pulsante per generare il PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> <!-- Libreria per catturare il contenuto HTML come immagine -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> <!-- Libreria per generare PDF -->




    <script>
        let isDictating = false; // Variabile per controllare se la dettatura è in corso
        let count = 1;  // Inizializza il valore del contatore degli operatori

        // 
        //######################################################### 
        // Funzione per il calcolo degli orari
        //#########################################################
        //   


        // Funzione per calcolare il totale delle ore lavorate
        function calculateTotal(element) {
            const row = element.closest('tr'); // Trova la riga più vicina all'elemento
            const startTimeInput = row.querySelector('.start-time'); // Trova il campo di input per l'ora di inizio
            const endTimeInput = row.querySelector('.end-time'); // Trova il campo di input per l'ora di fine
            const totalHoursInput = row.querySelector('.total-hours'); // Trova il campo di input per il totale delle ore

            const startTime = startTimeInput.value; // Ottiene il valore dell'ora di inizio
            const endTime = endTimeInput.value; // Ottiene il valore dell'ora di fine

            if (startTime && endTime) { // Se entrambi i valori sono presenti
                const startParts = startTime.split(':'); // Divide l'ora di inizio in ore e minuti
                const endParts = endTime.split(':'); // Divide l'ora di fine in ore e minuti

                const startDate = new Date(); // Crea un nuovo oggetto data per l'ora di inizio
                startDate.setHours(startParts[0], startParts[1], 0); // Imposta le ore e i minuti

                const endDate = new Date(); // Crea un nuovo oggetto data per l'ora di fine
                endDate.setHours(endParts[0], endParts[1], 0); // Imposta le ore e i minuti

                // Gestisce i turni notturni
                if (endDate <= startDate) {
                    endDate.setDate(endDate.getDate() + 1); // Aggiunge un giorno se l'ora di fine è minore o uguale all'ora di inizio
                }

                const totalMinutes = (endDate - startDate) / (1000 * 60); // Calcola il totale in minuti
                const hours = Math.floor(totalMinutes / 60); // Calcola le ore
                const minutes = totalMinutes % 60; // Calcola i minuti rimanenti

                totalHoursInput.value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`; // Format as hh:mm

                // Aggiorna il totale delle ore
                updateTotalHours();
            } else {
                totalHoursInput.value = ''; // Pulisce il totale se uno dei tempi non è impostato
            }
        }

        // Funzione per aggiornare il totale delle ore lavorate
        function updateTotalHours() {
            const totalHoursInputs = document.querySelectorAll('.total-hours:not(#total-hours-sum)'); // Escludi il campo di somma totale
            let totalHours = 0; // Inizializza il totale delle ore

            totalHoursInputs.forEach(input => {
                const timeValue = input.value; // Ottiene il valore del campo di input
                if (timeValue) {
                    const [hours, minutes] = timeValue.split(':').map(Number); // Divide il valore in ore e minuti
                    totalHours += hours + minutes / 60; // Converte il totale in ore
                }
            });

            const totalHoursSumInput = document.getElementById('total-hours-sum'); // Trova il campo di somma totale
            const totalHoursFormatted = formatHours(totalHours); // Format the total hours
            totalHoursSumInput.value = totalHoursFormatted; // Aggiorna il campo di somma totale

            // Calcola le ore totali moltiplicate per il numero di addetti
            const numberOfStaff = document.getElementById('numero-addetti').value || 0; // Ottiene il numero di addetti
            const totalHoursWithStaffInput = document.getElementById('total-hours-with-staff'); // Trova il campo per le ore totali con addetti
            totalHoursWithStaffInput.value = formatHours(totalHours * numberOfStaff); // Aggiorna il campo con il totale
        }

        // Funzione per formattare le ore in formato hh:mm
        function formatHours(totalHours) {
            
            const hours = Math.floor(totalHours); // Calcola le ore
            const minutes = Math.round((totalHours - hours) * 60); // Calcola i minuti
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`; // Format as hh:mm
        }



         // 
        //######################################################### 
        // Funzione per lo speech dictation
        //#########################################################
        //   

        // Funzione per avviare la dettatura vocale
        function startDictation(input) {
            if (isDictating) return; // Se la dettatura è già in corso, esci dalla funzione

            if (window.SpeechRecognition || window.webkitSpeechRecognition) { // Controlla se la dettatura è supportata
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)(); // Crea un nuovo oggetto di riconoscimento vocale
                recognition.lang = 'it-IT'; // Imposta la lingua su italiano
                recognition.interimResults = false; // Non mostra risultati intermedi

                recognition.onstart = function() {
                    isDictating = true; // Imposta la variabile a true quando inizia la dettatura
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript; // Ottiene il testo riconosciuto
                    input.value = transcript; // Imposta il valore dell'input al testo riconosciuto
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error); // Gestisce gli errori di riconoscimento
                    isDictating = false; // Imposta la variabile a false in caso di errore
                };

                recognition.onend = function() {
                    isDictating = false; // Imposta la variabile a false quando la dettatura termina
                };

                recognition.start(); // Avvia il riconoscimento vocale
            } else {
                alert('Speech recognition not supported in this browser.'); // Messaggio di errore se non supportato
            }
        }


        // 
        //######################################################### 
        // Funzione per le firme  con touchscreen o mouse
        //#########################################################
        //   

        // Seleziona i canvas e il contesto 2D
        const canvas1 = document.getElementById('canvas1');
        const canvas2 = document.getElementById('canvas2');
        // Configura i canvas inizialmente
        [canvas1, canvas2].forEach((canvas) => {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            console.log(`Canvas Dimension init:  ${canvas.width} - ${canvas.height}`);
            resizeCanvas(canvas);
        enableDrawing(canvas);
        });

        // Adatta le dimensioni dei canvas al ridimensionamento della finestra
            window.addEventListener('resize', () => {
            [canvas1, canvas2].forEach(resizeCanvas);
        });

        function resizeCanvas(canvas) {
            //  const parent = canvas.parentElement;
            //  const size = Math.min(parent.clientWidth / 2 - 20, 400); // Dimensioni dinamiche
            //  canvas.width = size;
            //  canvas.height = size;
            //  console.log(`Canvas Dimension var:  ${canvas.width} + ${canvas.height}`);
        }

        function enableDrawing(canvas) {
            const ctx = canvas.getContext('2d');
            let drawing = false;
            const startDrawing = (event) => {
                drawing = true;
                ctx.beginPath();
                const { x, y } = getCursorPosition(canvas, event);
                ctx.moveTo(x, y);
            };

            const draw = (event) => {
            if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                const { x, y } = getCursorPosition(canvas, event);
                console.log(`Canvas position ${rect.left} + ${rect.top}`);
                console.log("x"+((event.touches ? event.touches[0].clientX : event.clientX)));
                console.log("Y"+((event.touches ? event.touches[0].clientY : event.clientY)))
                console.log(`Line position: (${x}, ${y})`);
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                drawing = false;
                ctx.closePath();
            };

            const getCursorPosition = (canvas, event) => {
                const rect = canvas.getBoundingClientRect();
                const x = ((event.touches ? event.touches[0].clientX : event.clientX) - rect.left);
                const y = ((event.touches ? event.touches[0].clientY : event.clientY) - rect.top);
                return { x, y };
            };


            // Eventi per mouse e touchscreen
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);

            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);


            canvas.addEventListener('mousemove', (event) => {
                const { x, y } = getCursorPosition(canvas, event);
            });

        }




         // 
        //######################################################### 
        // Funzione per generare il pdf
        //#########################################################
        //   

        document.getElementById('generate-pdf').addEventListener('click', () => {
            const sede = document.getElementById('sede').value; // Ottiene il nome della sede
            const dataIntervento = document.getElementById('data-intervento').value; // Ottiene la data dell'intervento
            const formattedDate = new Date(dataIntervento).toLocaleDateString('it-IT'); // Formatta la data in gg-mm-aaaa

            generateTextFile(); // Genera il file di testo

            const { jsPDF } = window.jspdf; // Importa la libreria jsPDF

            // Cattura l'elemento da convertire in PDF
            html2canvas(document.querySelector('.content')).then(canvas => {
                const imgData = canvas.toDataURL('image/png'); // Cattura l'immagine del contenuto
                const pdf = new jsPDF(); // Crea un nuovo documento PDF
                const imgWidth = 190; // Larghezza dell'immagine nel PDF
                const pageHeight = pdf.internal.pageSize.height; // Altezza della pagina PDF
                const imgHeight = (canvas.height * imgWidth) / canvas.width; // Calcola l'altezza dell'immagine
                let heightLeft = imgHeight; // Altezza rimanente da stampare

                let position = 0; // Posizione corrente

                // Aggiungi l'immagine al PDF
                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight); // Aggiunge l'immagine al PDF
                heightLeft -= pageHeight; // Aggiorna l'altezza rimanente

                // Aggiungi nuove pagine se necessario
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight; // Calcola la nuova posizione
                    pdf.addPage(); // Aggiunge una nuova pagina
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight); // Aggiunge l'immagine alla nuova pagina
                    heightLeft -= pageHeight; // Aggiorna l'altezza rimanente
                }

                // Salva il PDF
                pdf.save(`Modulo Intervento - ${sede} - ${formattedDate}.pdf`); // Nome file con sede e data
                console.log("PDF generato e salvato come '" + `Modulo Intervento - ${sede} - ${formattedDate}.pdf` + "'."); // Messaggio di conferma
            }).catch(error => {
                console.error("Errore durante la generazione del PDF:", error); // Gestisce gli errori durante la generazione del PDF
            });
        });


            //const email = "salvatorebruno@rokepo.it";
            //const subject = `Modulo Intervento per - ${sede} - ${formattedDate}.pdf`;
            //const body =` Inserire negli allegati il file: Modulo Intervento - ${sede} - ${formattedDate}.pdf`;

            //const mailtoLink = `mailto:`;

        // 
        //######################################################### 
        // Funzione generazione file di testo
        //#########################################################
        //     

        function generateTextFile() {
            // Raccogli i dati dai campi
            let data = `Modulo Intervento\n-------------------\n`; // Inizializza il contenuto del file di testo

            // Funzione per ottenere il valore di un campo con gestione degli errori
            const getFieldValue = (id) => {
                const field = document.getElementById(id); // Trova il campo per ID
                return field ? field.value : 'N/A'; // Restituisce 'N/A' se il campo non esiste
            };
            // ---------------------------------------------------------------------------------------
            // Aggiungi i valori dei campi anagrafici
            const sede = getFieldValue('sede'); // Ottiene il valore della sede
            const dataIntervento = getFieldValue('data-intervento'); // Ottiene il valore della data dell'intervento
            const formattedDate = new Date(dataIntervento).toLocaleDateString('it-IT'); // Formatta la data in gg-mm-aaaa

            data += `Operatore: ${getFieldValue('operatore')}\n`; // Aggiunge l'operatore al file di testo
            data += `Data intervento: ${formattedDate}\n`; // Aggiunge la data dell'intervento al file di testo
            data += `Cliente: ${getFieldValue('cliente')}\n`; // Aggiunge il cliente al file di testo
            data += `Sede: ${sede}\n`; // Aggiunge la sede al file di testo
            //------------------------------------------------------------------------------------------
             // Aggiungi lo stato dei checkbox
            data += `Motivo dell'intervento:  `; // Inizio della sezione motivi
            const checkboxes = document.querySelectorAll('input[type="checkbox"]'); // Seleziona tutti i checkbox
            let selectedReasons = []; // Array per i motivi selezionati
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedReasons.push(checkbox.value); // Aggiunge il valore del checkbox selezionato
                    
                    // Trova il contenitore della checkbox
                    const checkboxLabel = checkbox.closest('.checkbox-label');
                    const checkboxLabelRight = checkboxLabel.querySelector('.checkbox-label-right'); // Trova il contenitore a destra

                    // Trova i campi del contratto/offerta e della data
                    const contractInput = checkboxLabelRight ? checkboxLabelRight.querySelector('input[type="text"]') : null; // Trova il campo del contratto/offerta
                    const dateInput = checkboxLabelRight ? checkboxLabelRight.querySelector('input[type="date"]') : null; // Trova il campo della data

                    const contractValue = contractInput ? contractInput.value : 'N/A'; // Ottiene il valore del contratto/offerta
                    const dateValue = dateInput ? dateInput.value : 'N/A'; // Ottiene il valore della data

                    selectedReasons.push(`(${checkbox.value} - Contratto/Offerta: ${contractValue}, Data: ${dateValue})`); // Aggiunge il motivo con contratto e data
                }
            });

            // Aggiungi i motivi selezionati al file di testo
            if (selectedReasons.length > 0) {
                data += selectedReasons.join(', ') + '\n'; // Aggiunge i motivi selezionati
            } else {
                data += 'Nessun motivo selezionato.\n'; // Messaggio se nessun motivo è selezionato
            }

            // Aggiungi i dettagli delle ore lavorate
            data += `Dettagli Ore Lavorate:\n`; // Inizio della sezione dettagli ore lavorate
            const totalHoursInputs = document.querySelectorAll('.total-hours'); // Seleziona tutti i campi di ore lavorate
            totalHoursInputs.forEach((input, index) => {
                if (index < 5) { // Limita a 5 lavori
                    const descriptionInput = document.querySelector(`input[placeholder="Descrizione lavoro ${index + 1}"]`); // Trova la descrizione del lavoro
                    data += `Descrizione lavoro ${index + 1}: ${descriptionInput ? descriptionInput.value : 'N/A'}, Ore: ${input.value || 'N/A'}\n`; // Aggiunge la descrizione e le ore lavorate
                }
            });
            
            
            data += `Chilometri percorsi: ${document.querySelector('input[placeholder="Km"]') ? document.querySelector('input[placeholder="Km"]').value : 'N/A'}\n`; // Aggiunge i chilometri percorsi
            data += `Ore viaggio: ${document.querySelector('input[placeholder="Ore-Viaggio"]') ? document.querySelector('input[placeholder="Ore-Viaggio"]').value : 'N/A'}\n`; // Aggiunge le ore di viaggio

           
            

            // Aggiungi il numero di addetti e le ore totali
            data += `Numero di addetti: ${getFieldValue('numero-addetti')}\n`; // Aggiunge il numero di addetti
            data += `Ore Totali (con addetti): ${getFieldValue('total-hours-with-staff')}\n`; // Aggiunge le ore totali con addetti

            // Aggiungi i prodotti utilizzati
            data += `Prodotti Utilizzati:\n`; // Inizio della sezione prodotti utilizzati
            const productRows = document.querySelectorAll('tbody tr'); // Seleziona tutte le righe della tabella dei prodotti
            productRows.forEach((row, index) => {
                if (index < 4) { // Limita a 4 prodotti
                    const productInput = row.querySelector('input[type="text"]'); // Input per il nome del prodotto
                    const quantityInput = row.querySelector('input[type="number"]'); // Input per la quantità
                    const noteInput = row.querySelector('input[placeholder="Note"]'); // Input per le note

                    const productName = productInput ? productInput.value : 'N/A'; // Ottiene il nome del prodotto
                    const quantity = quantityInput ? quantityInput.value : 'N/A'; // Ottiene la quantità
                    const note = noteInput ? noteInput.value : 'N/A'; // Ottiene le note

                    data += `Prodotto ${index + 1}: ${productName}, Quantità: ${quantity}, Note: ${note}\n`; // Aggiunge i dettagli del prodotto
                }
            });

            // Crea un blob di testo
            const blob = new Blob([data], { type: 'text/plain' }); // Crea un blob di testo
            const url = URL.createObjectURL(blob); // Crea un URL per il blob

            // Crea un link per il download
            const a = document.createElement('a'); // Crea un nuovo elemento <a>
            a.href = url; // Imposta l'URL del blob come href
            a.download = `Modulo Intervento - ${sede} - ${formattedDate}.txt`; // Nome file con sede e data
            document.body.appendChild(a); // Aggiunge il link al corpo del documento
            a.click(); // Simula un clic sul link per avviare il download
            document.body.removeChild(a); // Rimuove il link dal documento
            URL.revokeObjectURL(url); // Libera la memoria
            console.log("File di testo generato e scaricato come '" + a.download + "'."); // Messaggio di conferma



        }




          // 
        //######################################################### 
        // Funzione caricare i codici articolo da file di testo
        //#########################################################
        //   
        function loadArticoli() {
            fetch('Tabella articoli.txt') // Sostituisci con il percorso corretto del file
                .then(response => response.text())
                .then(data => {
                    const articoli = data.split('\n'); // Divide il contenuto in righe
                    const datalist = document.getElementById('articoli1'); // Ottiene il datalist
                    console.log(datalist);    
                    articoli.forEach(articolo => {
                        const option = document.createElement('option'); // Crea un nuovo elemento option
                        option.value = articolo.trim(); // Imposta il valore dell'opzione
                        datalist.appendChild(option); // Aggiunge l'opzione al datalist
                    });
                })
                
                .catch(error => console.error('Errore nel caricamento degli articoli:', error)); // Gestisce gli errori
        }

        // Carica gli articoli al caricamento della pagina
        window.onload = loadArticoli;



        // 
        //######################################################### 
        // Funzione per aggiungere operatore tramite pulsante +
        //#########################################################
        //   
        document.getElementById('add-operator').addEventListener('click', function() {
            count++; //aggiorna il contatore di operatori
            const operatorFieldContainer = document.getElementById('operator-field-container');
            const newField = document.createElement(`div`); // Crea un nuovo contenitore per il campo operatore
            newField.id = `operatoreNew${count}` // Imposta l'attributo id
            newField.className = 'field'; // Aggiungi la classe 'field' per lo stile
            // Crea il nuovo campo di input per l'operatore
            let InHTML =`
                <label for="operatore"${count} style="margin-left: 10px;">Operatore ${count}:</label>
                <input type="text" list="operatori" style="width: calc(100% - 200px); margin-right: 10px;" onfocus="startDictation(this)">
                <datalist id="operatori">
                    <option value="Maurizio Rispoli">
                    <option value="Marco Cumani">
                    <option value="Isiah Lewis">
                    <option value="Gianluca Papa">
                    <option value="Paolo Bonazzi">
                </datalist>
            `;
            newField.innerHTML = InHTML;
            operatorFieldContainer.appendChild(newField); // Aggiungi il nuovo campo al contenitore
            const textbox = document.getElementById("numero-addetti");
            textbox.value = count;  
        });
        
        

        //######################################################### 
        // Funzione per rimuovere operatore tramite pulsante -
        //#########################################################
        // 
        document.getElementById('remove-operator').addEventListener('click', function() {
            const elemento = document.getElementById(`operatoreNew${count}`);
            console.log(elemento);
            if (elemento) {
                elemento.remove();
                count--; //aggiorna il contatore di operatori
                console.log('Elemento rimosso');
            }    
            const textbox = document.getElementById("numero-addetti");
            textbox.value = count;  
        });
        

        //######################################################### 
        // Funzione per alzare le dimensioni delle textarea in altezza in base al numero di righe scritte
        //#########################################################
        // 

        const textarea = document.getElementById('descrizione-lavoro-1');

        textarea.addEventListener('input', () => {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
        });


    </script>
</body>
</html>